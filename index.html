<!DOCTYPE html>
<html lang="ja">

<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <meta name="description" content="BASEç”¨ã®ç”»åƒã‚’æ­£æ–¹å½¢ãƒ»1280pxãƒ»è»½é‡JPGã«è‡ªå‹•å¤‰æ›ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã€‚ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã§ç°¡å˜ã«ç”»åƒã‚’æœ€é©åŒ–ã§ãã¾ã™ã€‚">
 <title>Netshop Buddy - BASEç”»åƒæ•´å½¢ãƒ„ãƒ¼ãƒ«</title>
 <style>
  body {
   font-family: sans-serif;
   text-align: center;
   padding: 20px;
   background: #f4f4f4;
  }

  .container {
   max-width: 800px;
   margin: 0 auto;
   background: white;
   padding: 40px;
   border-radius: 10px;
   box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  h1 {
   color: #333;
   margin-bottom: 10px;
  }

  p {
   color: #666;
   margin-bottom: 30px;
  }

  /* ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ */
  .drop-zone {
   border: 3px dashed #ccc;
   border-radius: 10px;
   padding: 50px;
   cursor: pointer;
   transition: 0.3s;
   background: #fafafa;
  }

  .drop-zone:hover {
   border-color: #f6b01c;
   background: #fffdf5;
  }

  .drop-zone.dragover {
   border-color: #f6b01c;
   background: #ffe;
  }

  /* çµæœã‚¨ãƒªã‚¢ */
  #result-area {
   margin-top: 30px;
   display: grid;
   grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
   gap: 15px;
  }

  .img-card {
   border: 1px solid #ddd;
   padding: 5px;
   border-radius: 5px;
   background: white;
  }

  .img-card img {
   width: 100%;
   height: auto;
   display: block;
  }

  .download-btn {
   display: block;
   width: 100%;
   padding: 8px 0;
   margin-top: 5px;
   background: #333;
   color: white;
   text-decoration: none;
   font-size: 12px;
   border-radius: 3px;
  }

  .download-btn:hover {
   background: #555;
  }
 </style>
</head>

<body>

 <div class="container">
  <h1>Netshop Buddy ç”»åƒæ•´å½¢ãƒ„ãƒ¼ãƒ« ğŸ“¸</h1>
  <p>ç”»åƒã‚’ã“ã“ã«ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚<br>è‡ªå‹•ã§<b>ã€Œæ­£æ–¹å½¢ãƒ»1280pxãƒ»è»½é‡JPGã€</b>ã«å¤‰æ›ã—ã¾ã™ã€‚</p>

  <div class="drop-zone" id="dropZone">
   ğŸ“‚ ã“ã“ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç”»åƒã‚’é¸æŠ<br>ã¾ãŸã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ­ãƒƒãƒ—
   <input type="file" id="fileInput" multiple accept="image/*" style="display:none;">
  </div>

  <div id="result-area"></div>
 </div>

 <script>
  const TARGET_SIZE = 1280; // BASEæ¨å¥¨ã‚µã‚¤ã‚º
  const QUALITY = 0.85;     // ç”»è³ªï¼ˆ0.1ã€œ1.0ï¼‰

  const dropZone = document.getElementById('dropZone');
  const fileInput = document.getElementById('fileInput');
  const resultArea = document.getElementById('result-area');

  // ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã®ã‚¤ãƒ™ãƒ³ãƒˆ
  dropZone.addEventListener('click', () => fileInput.click());
  dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('dragover'); });
  dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
  dropZone.addEventListener('drop', (e) => {
   e.preventDefault();
   dropZone.classList.remove('dragover');
   handleFiles(e.dataTransfer.files);
  });
  fileInput.addEventListener('change', (e) => handleFiles(e.target.files));

  function handleFiles(files) {
   Array.from(files).forEach(file => {
    if (!file.type.startsWith('image/')) return;
    processImage(file);
   });
  }

  function processImage(file) {
   const reader = new FileReader();
   reader.onload = (e) => {
    const img = new Image();
    img.onload = () => {
     const canvas = document.createElement('canvas');
     const ctx = canvas.getContext('2d');

     // 1. æ­£æ–¹å½¢ã«ãƒˆãƒªãƒŸãƒ³ã‚°ã™ã‚‹ãŸã‚ã®è¨ˆç®—ï¼ˆä¸­å¤®åˆ‡ã‚ŠæŠœãï¼‰
     const minSide = Math.min(img.width, img.height);
     const sx = (img.width - minSide) / 2;
     const sy = (img.height - minSide) / 2;

     // 2. ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚ºã‚’BASEæ¨å¥¨ã®1280pxã«è¨­å®š
     canvas.width = TARGET_SIZE;
     canvas.height = TARGET_SIZE;

     // 3. æç”»ï¼ˆãƒªã‚µã‚¤ã‚ºï¼†ãƒˆãƒªãƒŸãƒ³ã‚°ï¼‰
     ctx.fillStyle = "#FFFFFF"; // ä½™ç™½ãŒå‡ºãŸã¨ãç”¨ï¼ˆåŸºæœ¬å‡ºãªã„ï¼‰
     ctx.fillRect(0, 0, TARGET_SIZE, TARGET_SIZE);
     ctx.drawImage(img, sx, sy, minSide, minSide, 0, 0, TARGET_SIZE, TARGET_SIZE);

     // 4. ç”»åƒãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆ (JPEG, ç”»è³ª85%)
     const dataUrl = canvas.toDataURL('image/jpeg', QUALITY);

     // 5. è¡¨ç¤ºã¨ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ä½œæˆ
     createResultCard(dataUrl, file.name);
    };
    img.src = e.target.result;
   };
   reader.readAsDataURL(file);
  }

  function createResultCard(dataUrl, originalName) {
   const div = document.createElement('div');
   div.className = 'img-card';

   const img = document.createElement('img');
   img.src = dataUrl;

   const link = document.createElement('a');
   link.href = dataUrl;
   // ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ "converted_å…ƒã®åå‰.jpg" ã«ã™ã‚‹
   const newName = originalName.replace(/\.[^/.]+$/, "") + "_base.jpg";
   link.download = newName;
   link.textContent = "â¬‡ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰";
   link.className = "download-btn";

   div.appendChild(img);
   div.appendChild(link);
   resultArea.appendChild(div);
  }
 </script>

</body>

</html>